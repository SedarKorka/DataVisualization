---
title: "mortality_indicators_luxembourg"
author: "Diallo Mamadou Korka"
date: "2022-11-25"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```
#library

```{r ,fig.width=8, fig.height=8, comment = NA, echo=FALSE, message = FALSE, warning = FALSE}
library(readr)
library(tidyselect)
library(tidyverse)
library(broom)
library(vroom)
library(gganimate)
library(maps)
library(cowplot)
library(tinytex)

```

#Link to Download the dataset https://platform.who.int/mortality/countries/country-details/MDB/luxembourg
#Link to Download the dataset world https://platform.who.int/mortality/themes/theme-details/MDB/noncommunicable-diseases
#https://ourworldindata.org/age-structure
#Read the dataset and Tidy.

```{r ,fig.width=8, fig.height=8, comment = NA, echo=FALSE, message = FALSE, warning = FALSE}

#Mortality in Luxembourg
Mortality<-read_csv("data/Mortality_Database_Luxembourg.csv",
                    skip = 9,
    
        
      col_names  = c( "Indicator_Code",
                     "Indicator_Name",
                     "Year",
                     "Sex",
                     "Age_group_code",
                     "Age_Group",
                     "Number",
                     "Percentage_of_cause_specific_deaths_out_of_total_deaths",
                     "Age_standardized_death_rate_per_100000_standard_population",
                     "Death_rate_per_100000_population",
                     "Dumm"),
         show_col_types = TRUE)

#Mortality

#Mortality causes by noncauminicate desease in the in luxembourg from 1967
Noncauminicate_in_luxembourg<-read_csv("data/Luxembourg/WHOMortalityDatabase_Trends_years_sex_a_country_area_age-Noncommunicable diseases_1st January 2023 17_38.csv",
                         skip = 7,
                         col_names  = c( "Region_Code",
                     "Region_Name",
                     "Country_Code",
                     "region",
                     "Year",
                     "Sex",
                     "Age_group_code",
                     "Age_Group",
                     "Number",
                     "Percentage_of_cause_specific_deaths_out_of_total_deaths",
                     "Age_standardized_death_rate_per_100_000_standard_population",
                     "Death_rate_per_100_000_population",
                     ""),
         show_col_types = TRUE)
#Noncauminicate_in_luxembourg

#Mortality causes by noncauminicate desease in the world
Noncauminicate<-read_csv("data/WHOMortalityDatabase_Map_Noncommunicable_diseases_14th_December_2022_17_17.csv",
                         skip = 7,
                         col_names  = c( "Region_Code",
                     "Region_Name",
                     "Country_Code",
                     "region",
                     "Year",
                     "Sex",
                     "Age_group_code",
                     "Age_Group",
                     "Number",
                     "Percentage_of_cause_specific_deaths_out_of_total_deaths",
                     "Age_standardized_death_rate_per_100_000_standard_population",
                     "Death_rate_per_100_000_population",
                     ""),
         show_col_types = TRUE)
#Noncauminicate

#Population by group age Europe
Population<-read_csv("data/age_dependency_ratio_of_working_age_population.csv",
                         skip = 7,
                         col_names  = c( "region",
                     "Code",
                     "Year",
                     "estimates_age",
                     ""),
         show_col_types = TRUE)
#Population

```

<p>
We want to see how the death rate varies over the years 1960 to 2021. We specifically select deaths for all age groups. During our analysis, we will notice the difference by gender.
</p>
```{r echo=FALSE}


Mortality %>% filter(Age_group_code == "Age_all", Indicator_Name=="All Causes" ) %>% 

ggplot(aes(x=Year, y=Death_rate_per_100000_population, group=Sex))+
  geom_line(aes(color=Sex))+
  geom_point(aes(color=Sex))+
  xlab("Year") + ylab("Death rate per 100,000 population") +
  ggtitle("Mortality rate over years in Luxembourg")+
  transition_reveal(Year)

```

<p>
We notice that in Luxembourg, the mortality rate was very high in 1960.
because in Luxembourg there have been several epidemics that could affect lives.
However, from 1960 to 2020, this rate has decreased. This makes sense, because Luxembourg has adopted more modern treatment methods.
</p>
<p>
We shall now analyze some major causes of mortality in luxembourg and how these causes have affected different age groups.
</p>

```{r, comment = NA, echo=FALSE, message = FALSE, warning = FALSE}
Mortality |> count(Indicator_Name, sort = TRUE)

ggplot(data = Mortality |> filter(Number>1000 , Indicator_Name != "All Causes")) + 
  geom_col(aes(y = Number, x = Year, fill=Indicator_Name)) +
  facet_wrap(~Indicator_Name)

```
<p>
We have traced some of the leading causes of death in Luxembourg over the years. From the plot, we can see that the number of deaths is quite high for the non-communication disease.

Deaths from cardiovascular diseases and malignant diseases are steadily declining. This can be attributed to improved sanitation infrastructure.

Malignant diseases, on the other hand, seemed low in the years 2004, then there was a surge around 2005 until 2021. This may be due to large outbreaks of malignant diseases or may be due to the age effect of the population.

Because the Luxembourg population was aging at a certain time.

</p>
<br/>

<p>
Now we know the biggest cause of death which is the non-communicate diseases. Then we should visualize. this cause to mortalize by age category. In order to see which age bracket is the most affected.

</p>


#Number of deaf by noncommunicatif desease by cat age
```{r, comment = NA, echo=FALSE, message = FALSE, warning = FALSE}
#summurase
#(?<=\\[).*(?=\\])

#Mortality

Mortality %>% filter(Indicator_Name =="Noncommunicable diseases", Age_group_code != "Age_all") %>%
  mutate(Age_by_group_New = str_extract(Age_Group,"(\\d)+") %>% as.numeric(),
         Age_by_group_New = if_else(Age_group_code == "Age_all", 74, Age_by_group_New),
         Age_Group = fct_reorder(Age_Group, Age_group_code)) %>%
  
  ggplot(aes(x = Age_Group, y=Death_rate_per_100000_population, fill=Sex))+
  geom_col(size=2, alpha=0.5)+
  #geom_line(size=1)+
  theme_minimal()+
  labs(title="Yearly Culmulative mortality by NonComunication deseses in Luxembourg")+
  theme(axis.text.x = element_text(angle = 90))#+
  #transition_reveal(Year)
 


```

<p>
Here we plot the number of deaths from non-communication diseases for different age groups. From the graph, we can understand that the number of deaths due to non_communication issues is maximum for the age groups from 0 and also age groups between 54 and 74 years old. We also note that the number of deaths due to non-communication of illnesses is down slightly for the young population. The top no.

child deaths may be due to the fact that children of this age are not strong enough to resist this disease. It is noted that the number of deaths is also relatively higher among the elderly than among middle-aged adults. This may be the case with older people who do not have strong immunity against non-communication diseases.
  </p>



<i>
since we find that this disease has more effect on older people. So we can visualize how this disease causes mortality during the years 1960 to 2021.

</i>

```{r} 

anim <- ggplot(data = Noncauminicate_in_luxembourg,aes(x= Age_Group , y=Death_rate_per_100_000_population)) + 
    geom_segment( aes(x=Age_Group, xend=Age_Group, y=0, yend=Death_rate_per_100_000_population, fill=Sex, color=Sex)) +
  
    geom_point(size=4) + 
  
geom_label(aes(Age_Group, Death_rate_per_100_000_population , label = signif(Death_rate_per_100_000_population)), 
           colour = "darkred", nudge_x = 0.35, size = 4)+
  
  
  labs(title="Mortality due to non-communicating diseases in the elderly population advances from 1960 to 2021",
       subtitle="En {closest_state}",
       x="Age_Group",
       y="Death rate per 100 000 population",
       caption="")+
  
  
  transition_states(states=Year,
                    transition_length = 1,
                    state_length = 2)
anim


```


<p>
Comparing the mortality cause by noncomminicate desase in Luxembourg to other country from 54 to 74
</p>



```{r echo=FALSE}


mapdata <- map_data("world")

newDataForNonCauminicate<-Noncauminicate %>% select(region, Number) 
       
#newDataForNonCauminicate 
mapdata_join<-inner_join(mapdata,newDataForNonCauminicate, by="region")


newMapdata<-mapdata_join %>% filter(!is.na(mapdata_join$Number))

map1<- ggplot(newMapdata, aes(x = long, y = lat,fill=Number, group=group))+
  geom_polygon(color="black")+ 
  theme(panel.background = element_rect(fill = "#101045")) +
  coord_equal()

#map1

map2<-map1 + scale_fill_gradient(name="%Number of dies", low = "Yellow", high="red", na.value = "grey50")+
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        rect = element_blank()
        )

#map2

ggdraw() +
  draw_image("C:/Users/user/Documents/Data science/R/DataVisualization/bill.jpg",  x = 0.35, y = 0.3, scale = .2) +
  draw_plot(map2)

```

#Life experience in 2000 comparing the rest of the word in 2000(Map) with noncommunication desases

```{r echo=FALSE}
Population

#gpl1 <- ggplot(data = Noncauminicate_in_luxembourg) +
 # geom_sf(aes(fill=Death_rate_per_100_000_population, group = group),  col = "black", lwd = 0.3 )+
  #xlab(NULL) + ylab(NULL) +
  #ggtitle("World Export of Merchandise", subtitle = "{frame_time}")+
  #geom_sf(data = bb, col = "grey", fill = "transparent") +
  #theme(plot.background = element_rect(fill = "white"),
   #     panel.background = element_rect(fill = 'white'),
    #    panel.grid.major = element_line(colour = "grey"),
     #   legend.position="top",
      #  plot.title = element_text(lineheight=.8, size=24, face="bold",
  #                                vjust=1),
       # legend.text = element_text(vjust=.4,lineheight=1,size = 14),
        #legend.title = element_text(vjust=1,lineheight=1, size=14,
 #                                   face="bold" )) +
#  transition_time(time)
  # coord_sf(crs = "+proj=eqearth +wktext") # couldn't get this coord to work



```

#study cas of the mortality by noncommunicate deseas(Regression linear)

```{r echo=FALSE}
ggplot(data = Mortality |> filter(Indicator_Name =="Noncommunicable diseases")) + 
  geom_point(aes(y =Number , x = Age_Group, fill=Sex)) #+
  #geom_bar()
  
  #facet_wrap(~Sex)

```

#Prediction for 2023

```{r}

```
