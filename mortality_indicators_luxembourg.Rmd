---
title: "The mortality rate in Luxembourg from 1960 to 2021"
author: "Diallo Mamadou Korka"
date: "2022-11-25"
output:
  html_document:
    css: "styles.css"
  pdf_document: default
  
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```


```{r ,fig.width=8, fig.height=8, comment = NA, echo=FALSE, message = FALSE, warning = FALSE}
library(readr)
library(tidyselect)
library(tidyverse)
library(broom)
library(vroom)
library(gganimate)
library(maps)
library(cowplot)
library(tinytex)
library(plotly)
library(viridis)
library(gifski)


```



<div class="card">
  <div class="card-header">
    Data Set
  </div>
  <blockquote>
The professor suggested that it would be more efficient to download the datasets directly using the provided links on the website. However, the source of the datasets was set up in a way that did not allow for copying the links. As a result, I had to download the datasets directly from the website. The datasets used in this study include: 'Who compose mortality rates in Luxembourg with cause rate', 'Non communication in Luxembourg', and 'Population by age group'. The links for these datasets are as follows: <a href="https://platform.who.int/mortality/countries/country-details/MDB/luxembourg">Who compose mortality rates in Luxembourg with cause rate</a>, <a href="https://platform.who.int/mortality/themes/theme-details/MDB/noncommunicable-diseases">Non communication in Luxembourg</a>, and <a href="https://ourworldindata.org/age-structure">Population by age group</a>.
</blockquote>




```{r ,fig.width=8, fig.height=8, comment = NA, echo=FALSE, message = FALSE, warning = FALSE}

#Mortality in Luxembourg
Mortality<-read_csv("data/Mortality_Database_Luxembourg.csv",
                    skip = 9,
    
        
      col_names  = c( "Indicator_Code",
                     "Indicator_Name",
                     "Year",
                     "Sex",
                     "Age_group_code",
                     "Age_Group",
                     "Number",
                     "Percentage_of_cause_specific_deaths_out_of_total_deaths",
                     "Age_standardized_death_rate_per_100000_standard_population",
                     "Death_rate_per_100000_population",
                     "Dumm"),
         show_col_types = TRUE)


#Mortality causes by noncauminicate desease in the in luxembourg from 1967
Noncauminicate_in_luxembourg<-read_csv("data/Luxembourg/WHOMortalityDatabase_Trends_years_sex_a_country_area_age-Noncommunicable diseases_1st January 2023 17_38.csv",
                         skip = 7,
                         col_names  = c( "Region_Code",
                     "Region_Name",
                     "Country_Code",
                     "region",
                     "Year",
                     "Sex",
                     "Age_group_code",
                     "Age_Group",
                     "Number",
                     "Percentage_of_cause_specific_deaths_out_of_total_deaths",
                     "Age_standardized_death_rate_per_100_000_standard_population",
                     "Death_rate_per_100_000_population",
                     ""),
         show_col_types = TRUE)
#Noncauminicate_in_luxembourg

#Mortality causes by noncauminicate desease in the world
Noncauminicate<-read_csv("data/WHOMortalityDatabase_Trends_years_many_countries_by_age_sex-Noncommunicable diseases_7th January 2023 03_11.csv",
                         skip = 7,
                         col_names  = c( "Region_Code",
                     "Region_Name",
                     "Country_Code",
                     "region",
                     "Year",
                     "Sex",
                     "Age_group_code",
                     "Age_Group",
                     "Number",
                     "Percentage_of_cause_specific_deaths_out_of_total_deaths",
                     "Age_standardized_death_rate_per_100_000_standard_population",
                     "Death_rate_per_100_000_population",
                     ""),
         show_col_types = TRUE)
#Noncauminicate

#Population by group age Europe
Population<-read_csv("data/age_dependency_ratio_of_working_age_population.csv",
                         skip = 7,
                         col_names  = c( "region",
                     "Code",
                     "Year",
                     "estimates_age",
                     ""),
         show_col_types = TRUE)
#Population

```


  </div> 






<div class="card no_buttom_brder">
<div class="card-header">

        Examining Temporal Trends and Gender Disparities in Mortality Rates, 1960-2021
    
</div>
  
<div class="card-body">
  
The objective of this study is to investigate the temporal dynamics of mortality rates from 1960 to 2021, encompassing individuals of all age groups. A key focus of the analysis will be to assess potential disparities in mortality rates between males and females.
        

```{r , comment = NA, echo=FALSE, message = FALSE, warning = FALSE}


Mortality %>% filter(Age_group_code == "Age_all", Indicator_Name=="All Causes" ) %>% 

ggplot(aes(x=Year, y=Death_rate_per_100000_population, group=Sex))+
  geom_line(aes(color=Sex))+
  geom_point(aes(color=Sex))+
  xlab("Year") + ylab("Death rate per 100,000 population") +
  ggtitle("Mortality rate over years in Luxembourg")+
  transition_reveal(Year)

```

</div>      
<div class="card-footer">
We notice that in Luxembourg, the mortality rate was very high in 1960.because in Luxembourg there have been several epidemics that could affect lives.However, from 1960 to 2020, this rate has decreased. This makes sense, because Luxembourg has adopted more modern treatment methods.
</div>

</div>



<div class="card">
<div class="card-header">

    We shall now analyze some major causes of mortality in luxembourg and how these causes have affected different age groups.
    
</div>
  
<div class="card-body">


```{r, comment = NA, echo=FALSE, message = FALSE, warning = FALSE}
Mortality |> count(Indicator_Name, sort = TRUE)

ggplot(data = Mortality |> filter(Number>1000 , Indicator_Name != "All Causes")) + 
  geom_col(aes(y = Number, x = Year, fill=Indicator_Name)) +
  facet_wrap(~Indicator_Name)

```

</div>

<div class="card-footer">
  

<p>
We have identified some of the major causes of mortality in Luxembourg over the years. According to our data, the number of deaths due to non-communicable diseases is quite high.

Deaths from cardiovascular diseases and cancer have been steadily decreasing, which may be due to improvements in sanitation infrastructure.

Cancer deaths appeared to be low in the years 2004, but then saw an increase around 2005 until 2021. This could be due to outbreaks of cancer or the aging of the Luxembourg population.

It is worth noting that the population of Luxembourg has been aging over this time period.

</p>

  </div>
</div>



<div class="card no_buttom_brder">
<div class="card-header">

Given that non-communicable diseases are the leading cause of death, it is important to visualize the impact of these conditions on mortality by age group. This will allow us to identify which age brackets are most affected.

    
</div> 
<div class="card-body">

```{r, comment = NA, echo=FALSE, message = FALSE, warning = FALSE}
#summurase
#(?<=\\[).*(?=\\])

#Mortality

Mortality %>% filter(Indicator_Name =="Noncommunicable diseases", Age_group_code != "Age_all") %>%
  mutate(Age_by_group_New = str_extract(Age_Group,"(\\d)+") %>% as.numeric(),
         Age_by_group_New = if_else(Age_group_code == "Age_all", 74, Age_by_group_New),
         Age_Group = fct_reorder(Age_Group, Age_group_code)) %>%
  
  ggplot(aes(x = Age_Group, y=Death_rate_per_100000_population, fill=Sex))+
  geom_col(size=2, alpha=0.5)+
  #geom_line(size=1)+
  theme_minimal()+
  labs(title="Yearly Culmulative mortality by NonComunication deseses in Luxembourg")+
  theme(axis.text.x = element_text(angle = 90))#+
  #transition_reveal(Year)
 


```
</div>

<div class="card-footer">
Here we plot the number of deaths from non-communication diseases for different age groups. From the graph, we can understand that the number of deaths due to non_communication issues is maximum for the age groups from 0 and also age groups between 54 and 74 years old. We also note that the number of deaths due to non-communication of illnesses is down slightly for the young population. The top no.

child deaths may be due to the fact that children of this age are not strong enough to resist this disease. It is noted that the number of deaths is also relatively higher among the elderly than among middle-aged adults. This may be the case with older people who do not have strong immunity against non-communication diseases.
</div>
</div>




<div class="card">
<div class="card-header">

   We have determined that this disease disproportionately affects older individuals. As such, it is important to visualize how this disease has contributed to mortality trends from 1960 to 2021.
</div>
  
<div class="card-body">

```{r}
base <- Noncauminicate_in_luxembourg %>% filter(Sex == "All") %>% 
  plot_ly(x = ~Number, y = ~Age_Group, size = ~3, 
          text = ~Age_Group, hoverinfo = "text") %>%
  layout(xaxis = list(type = "log"))

base %>%
  add_markers(color = ~Age_Group, frame = ~Year, ids = ~Age_Group) %>%
  animation_opts(1000, easing = "elastic", redraw = FALSE) %>%
  animation_button(
    x = 1, xanchor = "right", y = 0, yanchor = "bottom"
  ) %>%
  animation_slider(
    currentvalue = list(prefix = "YEAR ", font = list(color="red"))
  )
```
</div>
<div class="card-footer">
Our analysis has shown that the 70-year age group has consistently had the highest number of mortality cases from 1967 to 1980
</div>

</div>



<p>
Comparing the mortality cause by noncomminicate desase in Luxembourg to other country from 54 to 74
</p>

#animate map

```{r ,fig.width=8, fig.height=8, comment = NA, echo=FALSE, message = FALSE, warning = FALSE}

mapdata <- map_data("world")
newDataForNonCauminicate<-Noncauminicate %>% select(region,Year, Number, Age_Group) 
#newDataForNonCauminicate 
mapdata_join<-inner_join(mapdata,newDataForNonCauminicate, by="region")

#mapdata_join

mapa_animado_4<-ggplot(data=mapdata_join, aes(long, lat,  group= group,  fill= Number)) +
  geom_polygon(color = "white",  size = 0.01) +
  theme_void() +
  #scale_fill_gradient(low="orange2", high="darkblue", na.value = "white") +
  scale_fill_viridis(option = "B", name= "Years",
                     guide = guide_colorbar(
                       direction = "horizontal",
                       barheight = unit(2, units = "mm"),
                       barwidth = unit(100, units = "mm"),
                       draw.ulim = FALSE,
                       title.position = "top",
                       title.hjust = 0.5,
                       title.vjust = 0.5,
                       na.value = "white"))  +
  labs(title="Life Expectancy",
       subtitle = "{current_frame}",
       caption = "Source: gapminder.org")  +
  theme(
    plot.title = element_text(size = 12, hjust = 0.5),
    plot.subtitle = element_text(size = 10, hjust = 0.5),
    plot.caption = element_text(size = 8, hjust = 1),
    legend.position = "bottom") +
  coord_fixed (ratio = 1.3) +
  transition_manual(Year)


animate(mapa_animado_4, 
        fps = 10, 
        height = 500, 
        width = 700)

```

#Life experience in 2000 comparing the rest of the word in 2000(Map) with noncommunication desases




<p>
representation of the population of the countries most affected by non-communicable diseases by age from 1960 to 1970

</p>


```{r ,fig.width=8, fig.height=8, comment = NA, echo=FALSE, message = FALSE, warning = FALSE}


gap <- Population %>% 
  group_by(Year) %>%
  # The * 1 makes it possible to have non-integer ranks while sliding
  mutate(rank = min_rank(-estimates_age) * 1) %>%
  ungroup()

p <- ggplot(gap, aes(rank, group = region, 
                     fill = as.factor(region), color = as.factor(region))) +
 


  geom_tile(aes(y = estimates_age/2,
                height = estimates_age,
                width = 0.9), alpha = 0.8, color = NA) +



  # text in x-axis (requires clip = "off" in coord_*)
  # paste(country, " ")  is a hack to make pretty spacing, since hjust > 1 
  #   leads to weird artifacts in text spacing.
  geom_text(aes(y = 0, label = paste(region, " ")), vjust = 0.2, hjust = 1) +

  coord_flip(clip = "off", expand = FALSE) +
  scale_y_continuous(labels = scales::comma) +
  scale_x_reverse() +
  guides(color = FALSE, fill = FALSE) +

  

  labs(title='{closest_state}', x = "", y = "GFP per capita") +
  
  theme(plot.title = element_text(hjust = 0, size = 22),
        axis.ticks.y = element_blank(),  # These relate to the axes post-flip
        axis.text.y  = element_blank(),  # These relate to the axes post-flip
        plot.margin = margin(1,1,1,4, "cm")) +
  

  transition_states(Year, transition_length = 4, state_length = 1) +
  
  ease_aes('cubic-in-out')

animate(p, fps = 25, duration = 20, width = 800, height = 600)

```
