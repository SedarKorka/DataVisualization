---
title: "mortality_indicators_luxembourg"
author: "Diallo Mamadou Korka"
date: "2022-11-25"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```
#library

```{r echo=FALSE}
library(readr)
library(tidyselect)
library(tidyverse)
library(broom)
library(vroom)
library(gganimate)
library(maps)
library(cowplot)
library(tinytex)

```

#Link to Download the dataset https://platform.who.int/mortality/countries/country-details/MDB/luxembourg
#Link to Download the dataset world https://platform.who.int/mortality/themes/theme-details/MDB/noncommunicable-diseases
#https://ourworldindata.org/age-structure
#Read the dataset and Tidy.

```{r echo=FALSE}

#Mortality in Luxembourg
Mortality<-read_csv("data/Mortality_Database_Luxembourg.csv",
                    skip = 9,
    
        
      col_names  = c( "Indicator_Code",
                     "Indicator_Name",
                     "Year",
                     "Sex",
                     "Age_group_code",
                     "Age_Group",
                     "Number",
                     "Percentage_of_cause_specific_deaths_out_of_total_deaths",
                     "Age_standardized_death_rate_per_100000_standard_population",
                     "Death_rate_per_100000_population",
                     "Dumm"),
         show_col_types = TRUE)

#Mortality

#Mortality causes by noncauminicate desease in the in luxembourg from 1967
Noncauminicate_in_luxembourg<-read_csv("data/Luxembourg/Luxembourg.csv",
                         skip = 7,
                         col_names  = c( "Region_Code",
                     "Region_Name",
                     "Country_Code",
                     "region",
                     "Year",
                     "Sex",
                     "Age_group_code",
                     "Age_Group",
                     "Number",
                     "Percentage_of_cause_specific_deaths_out_of_total_deaths",
                     "Age_standardized_death_rate_per_100_000_standard_population",
                     "Death_rate_per_100_000_population",
                     ""),
         show_col_types = TRUE)
#Noncauminicate_in_luxembourg

#Mortality causes by noncauminicate desease in the world
Noncauminicate<-read_csv("data/WHOMortalityDatabase_Map_Noncommunicable_diseases_14th_December_2022_17_17.csv",
                         skip = 7,
                         col_names  = c( "Region_Code",
                     "Region_Name",
                     "Country_Code",
                     "region",
                     "Year",
                     "Sex",
                     "Age_group_code",
                     "Age_Group",
                     "Number",
                     "Percentage_of_cause_specific_deaths_out_of_total_deaths",
                     "Age_standardized_death_rate_per_100_000_standard_population",
                     "Death_rate_per_100_000_population",
                     ""),
         show_col_types = TRUE)
#Noncauminicate

#Population by group age Europe
Population<-read_csv("data/age_dependency_ratio_of_working_age_population.csv",
                         skip = 7,
                         col_names  = c( "region",
                     "Code",
                     "Year",
                     "estimates_age",
                     ""),
         show_col_types = TRUE)
#Population

```

<p>
We want to see how the death rate varies over the years 1960 to 2021. We specifically select deaths for all age groups. During our analysis, we will notice the difference by gender.
</p>
```{r echo=FALSE}


Mortality %>% filter(Age_group_code == "Age_all", Indicator_Name=="All Causes" ) %>% 

ggplot(aes(x=Year, y=Death_rate_per_100000_population, group=Sex))+
  geom_line(aes(color=Sex))+
  geom_point(aes(color=Sex))+
  xlab("Year") + ylab("Death rate per 100,000 population") +
  ggtitle("Mortality rate over years in Luxembourg")+
  transition_reveal(Year)

```

<p>
We notice that in Luxembourg, the mortality rate was very high in 1960.
because in Luxembourg there have been several epidemics that could affect lives.
However, from 1960 to 2020, this rate has decreased. This makes sense, because Luxembourg has adopted more modern treatment methods.
</p>
<p>
We shall now analyze some major causes of mortality in luxembourg and how these causes have affected different age groups.
</p>

```{r echo=FALSE}
Mortality |> count(Indicator_Name, sort = TRUE)

ggplot(data = Mortality |> filter(Number>1000)) + 
  geom_col(aes(y = Number, x = Year, color=Indicator_Name)) +
  facet_wrap(~Indicator_Name)

```

#Number of deaf by noncommunicatif desease by cat age
```{r echo=FALSE}
#summurase
#(?<=\\[).*(?=\\])

#Mortality

Mortality %>% filter(Indicator_Name =="Noncommunicable diseases") %>%
  mutate(Age_by_group_New = str_extract(Age_Group,"(\\d)+") %>% as.numeric(),
         Age_by_group_New = if_else(Age_group_code == "Age_all", 74, Age_by_group_New),
         Age_Group = fct_reorder(Age_Group, Age_group_code)) %>%
  
  ggplot(aes(x = Age_Group, y=Number, color=Sex))+
  geom_point(size=2, alpha=0.5)+
  #geom_line(size=1)+
  theme_minimal()+
  labs(title="Yearly Culmulative mortality by NonComunication deseses in Luxembourg")+
  theme(axis.text.x = element_text(angle = 90))#+
  #transition_reveal(Year)
 


```

#Find the Year , where we have most mortality from Age 54 to 74 in luxembourg
```{r echo=FALSE}

world_map <- map_data("world")

Luxembourg_map<-world_map %>% filter(region == "Luxembourg")

Noncauminicate_in_luxembourg<-Noncauminicate_in_luxembourg %>% select("region",
                     
                     "Year",
                     "Death_rate_per_100_000_population")

Luxembourg_map_join<-left_join(Luxembourg_map,Noncauminicate_in_luxembourg, by="region")

#Luxembourg_map_join

for (y in unique(Noncauminicate_in_luxembourg$Year)) {
  
   print(Noncauminicate_in_luxembourg %>%
    filter(Year == y) %>% 
    select(Year,region,Death_rate_per_100_000_population) %>% 
      
    
    ggplot() +
    geom_map(
      dat = Luxembourg_map, map = Luxembourg_map, aes(map_id = region),
      fill = "white", color = "#7f7f7f"
    ) +
    geom_map(map = Luxembourg_map, aes(map_id = region, fill = Death_rate_per_100_000_population)) +
    scale_fill_gradient(low = "white", high = "#cc4c02", name = "Fraction", limits = c(0, max(Noncauminicate_in_luxembourg$Death_rate_per_100_000_population))) +
    expand_limits(x = Luxembourg_map$long, y = Luxembourg_map$lat) + 
    labs(title = paste("Fraction of 50+ Population in ", y)))#+
    #transition_manual(frames = Year)
    
  
  
  
}



```

#Comparing the mortality cause by noncomminicate desase in Luxembourg to other country from 54 to 74

```{r echo=FALSE}


mapdata <- map_data("world")

newDataForNonCauminicate<-Noncauminicate %>% select(region, Number) 
       
#newDataForNonCauminicate 
mapdata_join<-inner_join(mapdata,newDataForNonCauminicate, by="region")


newMapdata<-mapdata_join %>% filter(!is.na(mapdata_join$Number))

map1<- ggplot(newMapdata, aes(x = long, y = lat,fill=Number, group=group))+
  geom_polygon(color="black")+ 
  theme(panel.background = element_rect(fill = "#101045")) +
  coord_equal()

#map1

map2<-map1 + scale_fill_gradient(name="%Number of dies", low = "Yellow", high="red", na.value = "grey50")+
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        rect = element_blank()
        )

#map2

ggdraw() +
  draw_image("C:/Users/user/Documents/Data science/R/DataVisualization/bill.jpg",  x = 0.35, y = 0.3, scale = .2) +
  draw_plot(map2)

```

#Life experience in 2000 comparing the rest of the word in 2000(Map) with noncommunication desases

```{r echo=FALSE}
Population



```

#study cas of the mortality by noncommunicate deseas(Regression linear)

```{r echo=FALSE}
ggplot(data = Mortality |> filter(Indicator_Name =="Noncommunicable diseases")) + 
  geom_point(aes(y =Number , x = Age_Group, fill=Sex)) #+
  #geom_bar()
  
  #facet_wrap(~Sex)

```

#Prediction for 2023

```{r}

```
